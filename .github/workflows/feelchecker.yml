name: feelchecker

on:
  schedule:
    # 15 分ごと
    - cron: '*/15 * * * *'
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-22.04
    steps:
      # ── ① ソース取得 ───────────────────────────────
      - uses: actions/checkout@v4

      # ── ② Python セットアップ ───────────────────────
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # ── ③ CSV 先頭 2 行だけ表示（デバッグ用） ───────
      - name: Check CSV head
        shell: bash
        run: |
          echo "=== CSV head ==="
          curl -sL "$SHEET_CSV" | head -n 2
          echo "================"

      # ── ④ Playwright ブラウザをインストール ────────
      - name: Install Playwright browsers
        run: |
          python -m pip install -r requirements.txt
          playwright install --with-deps

      # ── ⑤ feelchecker 実行 ─────────────────────────
      - name: Run feelchecker
        run: python feelchecker.py
        env:
          FEEL_USER: ${{ secrets.FEEL_USER }}
          FEEL_PASS: ${{ secrets.FEEL_PASS }}
          SHEET_CSV: ${{ secrets.SHEET_CSV }}
          CH_ACCESS: ${{ secrets.CH_ACCESS }}
