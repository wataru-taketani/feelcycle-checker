name: feelchecker

on:
  schedule:
    - cron: '*/15 * * * *'    # 15 åˆ†ã”ã¨
  workflow_dispatch:          # æ‰‹å‹•å®Ÿè¡Œ

jobs:
  run:
    runs-on: ubuntu-22.04

    # â”€â”€ ğŸ‘‡ ã“ã“ã§ä¸€æ‹¬æŒ‡å®šã™ã‚‹ã¨ ä»¥é™ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å‚ç…§å¯èƒ½ â”€â”€
    env:
      FEEL_USER: ${{ secrets.FEEL_USER }}
      FEEL_PASS: ${{ secrets.FEEL_PASS }}
      SHEET_CSV: ${{ secrets.SHEET_CSV }}
      CH_ACCESS: ${{ secrets.CH_ACCESS }}

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # Secrets ãŒæ¸¡ã£ã¦ã„ã‚‹ã‹ç¢ºèª
      - name: Debug SHEET_CSV
        shell: bash
        run: |
          echo "â–¶ len=$(echo -n "$SHEET_CSV" | wc -c) bytes"
          printf 'â–¶ hex ='
          echo -n "$SHEET_CSV" | od -An -tx1 | head -n 1

      # CSV ãŒå–ã‚Œã‚‹ã‹ç¢ºèª
      - name: Check CSV head
        shell: bash
        run: |
          echo "=== CSV head ==="
          curl -sL "$SHEET_CSV" | head -n 2
          echo "================"

      # ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª + Playwright
      - name: Install Python deps & Playwright browsers
        run: |
          python -m pip install -r requirements.txt
          playwright install --with-deps

      # æœ¬å‡¦ç†
      - name: Run feelchecker
        run: python feelchecker.py
