# -----------------------------------------------------------------------------
# FEELCYCLE 予約チェック ＆ LINE 通知
#   - 15 分おきに実行（cron）
#   - [Run workflow] ボタンで手動実行も可能（workflow_dispatch）
# -----------------------------------------------------------------------------
name: feelchecker

on:
  schedule:
    # 15 分おき（UTC）。必要に応じて変更してください
    - cron: '*/15 * * * *'
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-22.04

    # ───────────────────────────────────────
    # ❶ 予約チェック用スクリプトに渡す環境変数
    #    すべて GitHub Secrets に登録してある想定
    # ───────────────────────────────────────
    env:
      FEEL_USER:  ${{ secrets.FEEL_USER }}
      FEEL_PASS:  ${{ secrets.FEEL_PASS }}
      SHEET_CSV:  ${{ secrets.SHEET_CSV }}
      CH_ACCESS:  ${{ secrets.CH_ACCESS }}
      DEBUG: "1"           # ← デバッグ時だけコメントを外す

    steps:
    # ───────────────────────────────────────
    # ❷ ソースを取得
    # ───────────────────────────────────────
    - name: Checkout repository
      uses: actions/checkout@v4

    # ───────────────────────────────────────
    # ❸ Python をセットアップ（3.11）
    # ───────────────────────────────────────
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    # ───────────────────────────────────────
    # ❹ 必要ライブラリをインストール
    # ───────────────────────────────────────
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install "httpx[http2]" beautifulsoup4 lxml

    # ───────────────────────────────────────
    # ❺ 予約チェック & LINE 通知
    # ───────────────────────────────────────
    - name: Run feelchecker
      run: python feelchecker.py
